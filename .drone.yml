kind: pipeline
type: docker
name: API_Fantom_Games_Connection


trigger:
  event:
    - push


steps:
  # docker image build
  - name: set_server
    image: plugins/docker
    settings:
      dockerfile: ./Dockerfile
      context: ./
      registry: hub.codefirst.iut.uca.fr
      repo: hub.codefirst.iut.uca.fr/dorian.hodin/socketioservergames
      username:
        from_secret: SECRET_USERNAME
      password:
        from_secret: SECRET_PASSWD

  # container deployment
  - name: deploy_api
    image: hub.codefirst.iut.uca.fr/thomas.bellembois/codefirst-dockerproxy-clientdrone:latest
    environment:
      IMAGENAME: hub.codefirst.iut.uca.fr/dorian.hodin/socketioservergames:latest
      CONTAINERNAME: deploy_server
      COMMAND: create
      OVERWRITE: true
      ADMINS: dorianhodin,corentinrichard,jeremybesson,joanpierron,baptistemarcel
    depends_on: [ set_server ]
